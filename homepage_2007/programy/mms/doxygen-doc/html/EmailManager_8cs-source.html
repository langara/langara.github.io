<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Marek Mail System: tmp/test-doxy-mms/MarekMailSystem/MarekMailSystem2/EmailManager.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3-20071008 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>tmp/test-doxy-mms/MarekMailSystem/MarekMailSystem2/EmailManager.cs</h1><a href="EmailManager_8cs.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="keyword">using</span> System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Text;
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="keyword">namespace </span>MarekMailSystem2
<a name="l00006"></a>00006 {
<a name="l00007"></a>00007 
<a name="l00011"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html">00011</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classMarekMailSystem2_1_1EmailManager.html" title="This is the main class. Most of the time you will use only this class to send emails...">EmailManager</a> : <a class="code" href="classMarekMailSystem2_1_1EmailSender.html">EmailSender</a>
<a name="l00012"></a>00012     {
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="comment">//TODO: tutaj beda syskie Sendy w wersji schedule z dat¹ do schedulowania ofcourse..</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#f6f9e0ef7122680bf47d1269b03f2306">00017</a>         <span class="keyword">private</span> <a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html" title="This interface represents an Email Table (usually in some database).">IEmailTable</a> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#f6f9e0ef7122680bf47d1269b03f2306">ErrorTable</a>;
<a name="l00018"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#59667cb597cbc8203106154618a5ab59">00018</a>         <span class="keyword">private</span> <a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html" title="This interface represents an Email Table (usually in some database).">IEmailTable</a> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#59667cb597cbc8203106154618a5ab59">TemplateTable</a>;
<a name="l00019"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#d912811ea67b4724e686966578491c36">00019</a>         <span class="keyword">private</span> <a class="code" href="interfaceMarekMailSystem2_1_1IEmailSender.html">IEmailSender</a> <a class="code" href="classMarekMailSystem2_1_1EmailSender.html">EmailSender</a>;
<a name="l00020"></a>00020 
<a name="l00029"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#cb39f4e9fdbf18654c363da69d5403c9">00029</a>         <span class="keyword">public</span> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#78c1eb16b0832993699b2c459d356823" title="Defaul email manager constructor.">EmailManager</a>(<a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html" title="This interface represents an Email Table (usually in some database).">IEmailTable</a> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#f6f9e0ef7122680bf47d1269b03f2306">ErrorTable</a>, <a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html" title="This interface represents an Email Table (usually in some database).">IEmailTable</a> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#59667cb597cbc8203106154618a5ab59">TemplateTable</a>, <a class="code" href="interfaceMarekMailSystem2_1_1IEmailSender.html">IEmailSender</a> <a class="code" href="classMarekMailSystem2_1_1EmailSender.html">EmailSender</a>)
<a name="l00030"></a>00030             : base()
<a name="l00031"></a>00031         {
<a name="l00032"></a>00032             <span class="keyword">this</span>.ErrorTable = ErrorTable;
<a name="l00033"></a>00033             <span class="keyword">this</span>.TemplateTable = TemplateTable;
<a name="l00034"></a>00034             <span class="keyword">this</span>.EmailSender = EmailSender;
<a name="l00035"></a>00035         }
<a name="l00036"></a>00036 
<a name="l00040"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#78c1eb16b0832993699b2c459d356823">00040</a>         <span class="keyword">public</span> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#78c1eb16b0832993699b2c459d356823" title="Defaul email manager constructor.">EmailManager</a>() :this(
<a name="l00041"></a>00041             <span class="comment">//TODO: uncomment nhibernate versions..</span>
<a name="l00042"></a>00042             <span class="comment">//new NHibernateEmailTable("ErrorTable"),</span>
<a name="l00043"></a>00043             <span class="comment">//new NHibernateEmailTable("TemplateTable"),</span>
<a name="l00044"></a>00044             new <a class="code" href="classMarekMailSystem2_1_1DummyEmailTable.html">DummyEmailTable</a>(<span class="stringliteral">"ErrorTable"</span>),
<a name="l00045"></a>00045             new <a class="code" href="classMarekMailSystem2_1_1TestTemplateEmailTable.html">TestTemplateEmailTable</a>(),
<a name="l00046"></a>00046             new <a class="code" href="classMarekMailSystem2_1_1SmtpEmailSender.html" title="This class represents smtp client with can connect to some smtp server and send an...">SmtpEmailSender</a>())
<a name="l00047"></a>00047         {
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00059"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#1da79b23ce4c2d8dacef2153a260a943">00059</a>         <span class="keyword">public</span> <a class="code" href="classMarekMailSystem2_1_1EmailStatus.html" title="This class contains two enums: SendingStatus and SmtpStatus. SmtpStatus value is...">EmailStatus</a> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#1da79b23ce4c2d8dacef2153a260a943" title="Sends an email using a template. The &amp;#39;To&amp;#39; address is also read trom the template...">SendSavedTemplate</a>(<span class="keywordtype">string</span> TemplateName, Dictionary&lt;string, string&gt; context)
<a name="l00060"></a>00060         {
<a name="l00061"></a>00061             <a class="code" href="classMarekMailSystem2_1_1Email.html" title="Email class represents an e-mail. It has properties like: From, To, Subject, Body...">Email</a> <span class="keyword">template</span> = <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#59667cb597cbc8203106154618a5ab59">TemplateTable</a>.<a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html#318e701a30d92d117ef243e1ab71d82c">Load</a>(TemplateName);
<a name="l00062"></a>00062             <a class="code" href="classMarekMailSystem2_1_1EmailSender.html#3af3c3a505a6c1122a5085acb2030112" title="Replaces variables in email fields like $FOO by context[&amp;quot;FOO&amp;quot;], and then...">SendTemplate</a>(<span class="keyword">template</span>, context);
<a name="l00063"></a>00063             <span class="keywordflow">return</span> <span class="keyword">template</span>.SendingStatus;
<a name="l00064"></a>00064         }
<a name="l00065"></a>00065 
<a name="l00073"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#367510a9562a7427476c52a0e84b4932">00073</a>         <span class="keyword">public</span> <a class="code" href="classMarekMailSystem2_1_1EmailStatus.html" title="This class contains two enums: SendingStatus and SmtpStatus. SmtpStatus value is...">EmailStatus</a> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#1da79b23ce4c2d8dacef2153a260a943" title="Sends an email using a template. The &amp;#39;To&amp;#39; address is also read trom the template...">SendSavedTemplate</a>(<span class="keywordtype">string</span> To, <span class="keywordtype">string</span> TemplateName, Dictionary&lt;string, string&gt; context)
<a name="l00074"></a>00074         {
<a name="l00075"></a>00075             context[<span class="stringliteral">"TO"</span>] = To;
<a name="l00076"></a>00076             <a class="code" href="classMarekMailSystem2_1_1Email.html" title="Email class represents an e-mail. It has properties like: From, To, Subject, Body...">Email</a> <span class="keyword">template</span> = <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#59667cb597cbc8203106154618a5ab59">TemplateTable</a>.<a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html#318e701a30d92d117ef243e1ab71d82c">Load</a>(TemplateName);
<a name="l00077"></a>00077             <a class="code" href="classMarekMailSystem2_1_1EmailSender.html#3af3c3a505a6c1122a5085acb2030112" title="Replaces variables in email fields like $FOO by context[&amp;quot;FOO&amp;quot;], and then...">SendTemplate</a>(<span class="keyword">template</span>, context);
<a name="l00078"></a>00078             <span class="keywordflow">return</span> <span class="keyword">template</span>.SendingStatus;
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="comment">//public EmailStatus SendSavedTemplate(string To, string Cc, string TemplateName, Dictionary&lt;string, string&gt; context)</span>
<a name="l00083"></a>00083         <span class="comment">//{</span>
<a name="l00084"></a>00084         <span class="comment">//    context["TO"] = To;</span>
<a name="l00085"></a>00085         <span class="comment">//    context["CC"] = Cc;</span>
<a name="l00086"></a>00086         <span class="comment">//    Email template = TemplateTable.Load(TemplateName);</span>
<a name="l00087"></a>00087         <span class="comment">//    SendTemplate(template, context);</span>
<a name="l00088"></a>00088         <span class="comment">//    return template.SendingStatus;</span>
<a name="l00089"></a>00089         <span class="comment">//}</span>
<a name="l00090"></a>00090 
<a name="l00095"></a><a class="code" href="classMarekMailSystem2_1_1EmailManager.html#9249a59c7c17932356ba27d78c30587d">00095</a>         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#9249a59c7c17932356ba27d78c30587d" title="Sends an arbitrary email.">Send</a>(<a class="code" href="classMarekMailSystem2_1_1Email.html" title="Email class represents an e-mail. It has properties like: From, To, Subject, Body...">Email</a> email)
<a name="l00096"></a>00096         {
<a name="l00097"></a>00097             <a class="code" href="classMarekMailSystem2_1_1EmailSender.html">EmailSender</a>.Send(email);
<a name="l00098"></a>00098             <span class="comment">// TODO: ponizszy kod jest.. tak mniejwiecej.. jak zrobie nhibernatowanie to przejrzec to i zrobic porzadnie..</span>
<a name="l00099"></a>00099             <span class="keywordflow">if</span> (email.<a class="code" href="classMarekMailSystem2_1_1Email.html#e7cead5914bfb33e0d6f170546cb3617" title="Gets the email sending status. See EmailStatus class for details.">SendingStatus</a>.<a class="code" href="classMarekMailSystem2_1_1EmailStatus.html#da2451d6f24b10311c570a0bbeb0563a">Status</a> != <a class="code" href="namespaceMarekMailSystem2.html#b82179e4509490bdddaf09ebda62ca62" title="This enum one of two enum properties used in EmailStatus class.">StatusCode</a>.Sent)
<a name="l00100"></a>00100                 <a class="code" href="classMarekMailSystem2_1_1EmailManager.html#f6f9e0ef7122680bf47d1269b03f2306">ErrorTable</a>.<a class="code" href="interfaceMarekMailSystem2_1_1IEmailTable.html#2604efbcce0543bc3406faeec6121c9e">Save</a>(email, <span class="stringliteral">"TODO: jaki tag?!"</span>);
<a name="l00101"></a>00101         }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Thu Oct 25 11:32:52 2007 for Marek Mail System by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3-20071008 </small></address>
</body>
</html>
